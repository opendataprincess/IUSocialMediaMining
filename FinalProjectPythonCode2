#Now onto the code to get all of the raw data. We must iterate through the Got3 search 30 times (5 search terms x 6 locations)

import got3
#Set Caracas-wide search with "escasez"(scarcity query) from December 2014 to October 2016
import got3
import pandas as pd
tweetCriteria = got3.manager.TweetCriteria()
tweetCriteria.setQuerySearch("escasez geocode:10.4806,-66.9036,10km")
tweetCriteria.setSince("2014-12-01")
tweetCriteria.setUntil("2016-09-30")
escasez_c_tweets = got3.manager.TweetManager.getTweets(tweetCriteria)

# Need to initialize an empty list to collect tweets
extracted_data = []

for tweet in escasez_c_tweets:
    tid = tweet.id
    #date_created = tweet.created_at
    date_created = tweet.date
    #favorite_count = tweet.favorite_count
    favorite_count = tweet.favorites
    #retweet_count = tweet.retweet_count
    retweet_count = tweet.retweets
    text = tweet.text
    #escasez_c_tweets = [tid, hour_created, text, favorite_count, retweet_count]
    # escasez_c_tweets is an existing object - it's the list of tweet objects
    # from GOT. We don't want to assign the data to escasez_c_tweets
    this_tweet_extracted_information = [tid, date_created, text, favorite_count, retweet_count]
    # tweetCriteria.append(escasez_c_tweets)
    # tweetCriteria is the tweet criteria object, not a list we can append to
    # I made an empty list above (line 2) the for loop to contain our tweet extracted info
    extracted_data.append(this_tweet_extracted_information)
    
# Argument to DataFrame is extracted_data, the list 
# of lists containing extracted data
df = pd.DataFrame(extracted_data)
# df.columns = ["tid", "date_created", "favorite_count", "retweet_count", "text"]
# The name of the columns should correspond to order that we designated for each tweet
# This occurs in line 16 in the above cell.
df.columns = ["tid", "date_created", "text", "favorite_count", "retweet_count"]
df.index = df["tid"]
del df["tid"]
df.shape
df

#Only show data with favorites count or retweet counts greater than 5
subset = df[ df['favorite_count'] > 5]
subset = df[ df['retweet_count'] > 5]
subset.shape
subset

df.to_csv("Escasez-Caracas.csv")
subset.to_csv("Escasez-filtered-Caracas.csv")

#Repeat the code above for each of the search terms ("Hambre", "Alimentos", "#VzlaTieneHambre" and 
"#AnaquelesVaciosenVenezuela") and for each of the municipalities (Caracas, Baruta, Chacao, El Hatillo, 
#Libertador and Sucre). The Tweet corpus is the fitered tweet set combined into 1 CSV file.
